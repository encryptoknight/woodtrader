<!DOCTYPE html>
<html>
<head>
    <title>Wood Trader Alpha</title>

    <script src="lib/easeljs-0.4.2.min.js"></script>
    <script>
        var canvas,
            stage,
            player = {idle: new Image(), walk: new Image()},
            playerWalkAnim,
            numImagesLoaded = 0,
            screenWidth;

        function init () {
            // find canvas and load images, wait for last image to load
            canvas = document.getElementById("game");
            stage = new Stage(canvas);

            player.idle.onload = handleImageLoad;
            player.idle.onerror = handleImageError;
            player.walk.onload = handleImageLoad;
            player.walk.onerror = handleImageError;

            player.idle.src = "assets/player/idle.png";
            player.walk.src = "assets/player/run.png";
        }

        function handleImageLoad (event) {
            numImagesLoaded++;

            if (numImagesLoaded == 2) {
                numImagesLoaded = 0;
                startGame();
            }
        }

        // called if there is an error loading the image (usually due to a 404)
        function handleImageError (e) {
            console.log("Error Loading Image : " + e.target.src);
        }

        function startGame() {
            // grab canvas width and height for later calculations
            screenWidth = canvas.width;

            // create spritesheet and assign the associated data
            var spriteSheetPlayerWalk = new SpriteSheet({
                images: [player.walk],
                frames: {width: 64, height: 64, regX: 32, regY: 32},
                animations: {
                    walk: [0, 9, "walk", 4]
                }
            });

            var spriteSheetPlayerIdle = new SpriteSheet({
                images: [player.idle],
                frames: {width: 64, height: 64, regX: 32, regY: 32},
                animations: {
                    idle: [0, 9, "idle", 4]
                }
            });

            SpriteSheetUtils.addFlippedFrames(spriteSheetPlayerWalk, true, false, false);

            // create a BitmapAnimation instance to display and play back the sprite sheet
            playerWalkAnim = new BitmapAnimation(spriteSheetPlayerWalk);
            playerIdleAnim = new BitmapAnimation(spriteSheetPlayerIdle);

            // start playing the first sequence
            playerWalkAnim.gotoAndPlay("walk_h");

            // Set up a shadow. Note that shadows are ridiculously expensive. You could display hundreds
            // of animated rats if you disabled the shadow
            playerWalkAnim.shadow = new Shadow("#454", 0, 5, 4);

            playerWalkAnim.name = "playerWalk";
            playerWalkAnim.direction = 90;
            playerWalkAnim.vX = 1;
            playerWalkAnim.x = playerIdleAnim.x = 16;
            playerWalkAnim.y = playerIdleAnim.y = 32;

            playerIdleAnim.name = "playerIdle";

            // have each monster start at a specific frame
            playerWalkAnim.currentFrame = 0;
            stage.addChild(playerWalkAnim);

            Ticker.addListener(window);
            Ticker.useRAF = true;
            // Best framerate targeted (60 FPS)
            Ticker.setInterval(17);
        }

        function tick () {
            // We've reached the right side of our screen;
            // we need to walk left now to go back to our initial position
            if (playerWalkAnim.x >= screenWidth - 16) {
                playerWalkAnim.direction = -90;
                playerWalkAnim.gotoAndPlay("walk");
            }

            // We've reached the left side of our screen;
            // we need to walk right now
            if (playerWalkAnim.x < 16) {
                playerWalkAnim.direction = 90;
                playerWalkAnim.gotoAndStop("walk");
                stage.removeChild(playerWalkAnim);
                playerIdleAnim.gotoAndPlay("idle");
                stage.addChild(playerIdleAnim);
            }

            // Move the sprite based on the direction and speed
            var direction = playerWalkAnim.direction == 90 ? '+' : '-';

            playerWalkAnim.x += parseInt(direction + playerWalkAnim.vX);

            // update the stage
            stage.update();
        }
    </script>
</head>
<body onload="init();">

<style>
    canvas {
        border: 1px solid blue;
    }
</style>

<canvas id="game" width="200" height="200"></canvas>

</body>
</html>